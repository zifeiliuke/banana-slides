#
# Banana Slides - .env.example
# 说明：复制为 .env 后按需修改；示例文件不要放真实密钥/Token
#

# =====================
# 基础配置
# =====================

LOG_LEVEL=INFO
FLASK_ENV=production
SECRET_KEY=your-secret-key-change-this-in-production
PORT=5000

# CORS 配置（多个地址用逗号分隔；生产建议精确到域名）
CORS_ORIGINS=*

# =====================
# 前端（Docker build args）
# =====================

# VITE_API_BASE_URL 为空表示前端走相对路径（通过 nginx proxy 转发到后端）
VITE_API_BASE_URL=

# SSE 推送任务进度（可选）
# 默认关闭：避免大量长连接占用 Web 线程；如启用建议适当提高 gunicorn threads
VITE_ENABLE_TASK_SSE=false

# docker-compose 映射前端端口（生产 compose 使用）
FRONTEND_PORT=80

# =====================
# AI Provider
# =====================

# "gemini" (默认): 使用 Google GenAI SDK
# "openai": 使用 OpenAI SDK 格式
AI_PROVIDER_FORMAT=gemini

# Gemini（AI_PROVIDER_FORMAT=gemini）
GOOGLE_API_KEY=your-api-key-here
# 代理示例: https://aihubmix.com/gemini
GOOGLE_API_BASE=https://generativelanguage.googleapis.com
GENAI_TIMEOUT=300.0
GENAI_MAX_RETRIES=2

# OpenAI（AI_PROVIDER_FORMAT=openai）
OPENAI_API_KEY=your-api-key-here
# 代理示例: https://aihubmix.com/v1
OPENAI_API_BASE=https://api.openai.com/v1
OPENAI_TEXT_TIMEOUT=10.0
OPENAI_TEXT_MAX_RETRIES=3
OPENAI_IMAGE_TIMEOUT=90.0
OPENAI_IMAGE_MAX_RETRIES=3

# 模型配置
TEXT_MODEL=gemini-3-flash-preview
IMAGE_MODEL=gemini-3-pro-image-preview

# =====================
# 数据库（必填）
# =====================

MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=your-mysql-username
MYSQL_PASSWORD=your-mysql-password
MYSQL_DATABASE=banana_slides

# docker-compose.prod.yml 的 mysql 容器会用到（后端本身不读取）
MYSQL_ROOT_PASSWORD=change-me

# 或者使用完整的 DATABASE_URL（优先级高于上面的分离配置）
# DATABASE_URL=mysql+pymysql://user:password@host:3306/database?charset=utf8mb4

# SQLAlchemy 连接池（每进程一份；Web/Worker 总连接数 = 进程数 * (pool_size + max_overflow)）
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_RECYCLE=3600

# =====================
# 异步任务队列（Redis + RQ，推荐生产开启）
# =====================

TASK_QUEUE_BACKEND=redis
# Docker compose 内推荐：
REDIS_URL=redis://redis:6379/0
# 若你在宿主机直接运行后端（非 docker），可改为：
# REDIS_URL=redis://localhost:6379/0

# 队列名（建议保留 fast/heavy 分离）
RQ_QUEUE_FAST=fast
RQ_QUEUE_HEAVY=heavy

# Worker 监听队列（docker-compose.prod.yml 会读取）
RQ_QUEUES_FAST=fast
RQ_QUEUES_HEAVY=heavy

# =====================
# 任务内部并发（每个任务内部的线程数）
# =====================

# 说明：
# - 这个并发是“单个任务内部”的线程数（例如一次批量生图任务会并发多少张）
# - 数值过大容易触发上游模型限流/重试，反而变慢（你日志里出现大量 Retrying request 就是典型信号）
# - 单机 6c/32G 的推荐起步值：图片 4、描述 5；再根据模型限流和机器负载微调
MAX_DESCRIPTION_WORKERS=5
MAX_IMAGE_WORKERS=4

# =====================
# Web 服务器（gunicorn）
# =====================

GUNICORN_WORKERS=4
GUNICORN_THREADS=4
GUNICORN_TIMEOUT=60
GUNICORN_GRACEFUL_TIMEOUT=30
GUNICORN_KEEPALIVE=5
GUNICORN_MAX_REQUESTS=2000
GUNICORN_MAX_REQUESTS_JITTER=200

# =====================
# MinerU / OCR / 其他依赖服务
# =====================

MINERU_TOKEN=your-mineru-token
MINERU_API_BASE=https://mineru.net

IMAGE_CAPTION_MODEL=gemini-3-flash-preview

BAIDU_OCR_API_KEY=you-baidu-api-key

# 输出语言：'zh' (中文), 'ja' (日本語), 'en' (English), 'auto' (自动)
OUTPUT_LANGUAGE=zh

# =====================
# 镜像源（国内用户推荐开启以加速构建）
# =====================

# 国内用户推荐使用以下镜像源，可将构建速度提升10倍以上
# 如在海外服务器部署，可注释掉这些配置使用官方源

DOCKER_REGISTRY=docker.1ms.run/
GHCR_REGISTRY=ghcr.nju.edu.cn/
APT_MIRROR=mirrors.aliyun.com
PYPI_INDEX_URL=https://mirrors.cloud.tencent.com/pypi/simple
NPM_REGISTRY=https://registry.npmmirror.com/
